<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 2: Bioassay - Internal Dosimetry Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Glossary System -->
    <script src="glossary-definitions.js"></script>
    <script src="glossary-modal.js"></script>
    
    <!-- Feedback System -->
    <script src="feedback-system.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
        }
        
        /* Progress tracking styles */
        .progress-bar {
            background: linear-gradient(to right, #10b981, #06b6d4, #3b82f6, #8b5cf6, #ef4444);
            transition: width 0.3s ease;
        }
        .progress-section {
            transition: all 0.3s ease;
        }
        .progress-section.completed {
            border-left-color: #10b981;
            background-color: #f0fdf4;
        }
        
        /* Progressive Disclosure Styles */
        .foundation-content {
            display: block;
        }
        .deep-dive-content {
            border-left: 3px solid #2563eb;
            padding-left: 12px;
            background-color: #eff6ff;
            border-radius: 6px;
            margin: 8px 0;
        }
        .rabbit-hole-content {
            border-left: 3px solid #7c3aed;
            padding-left: 12px;
            background-color: #f3e8ff;
            border-radius: 6px;
            margin: 8px 0;
        }
        .dive-deeper-btn {
            color: #2563eb;
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: 1px solid #2563eb;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }
        .dive-deeper-btn:hover {
            background-color: #2563eb;
            color: white;
            transform: translateX(2px);
        }
        .rabbit-hole-btn {
            color: #7c3aed;
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: 1px solid #7c3aed;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }
        .rabbit-hole-btn:hover {
            background-color: #7c3aed;
            color: white;
            transform: translateX(2px);
        }
        .glossary-term {
            color: #d97706;
            text-decoration: underline;
            text-decoration-style: dotted;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .glossary-term:hover {
            color: #92400e;
            background-color: #fef3c7;
            padding: 0 2px;
            border-radius: 2px;
        }
        
        /* Quiz styles */
        .quiz-question {
            display: none;
        }
        .quiz-question.active {
            display: block;
        }
        .quiz-option {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .quiz-option:hover {
            background-color: #f3f4f6;
        }
        .quiz-option.selected {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }
        .quiz-option.correct {
            background-color: #dcfce7;
            border-color: #16a34a;
        }
        .quiz-option.incorrect {
            background-color: #fee2e2;
            border-color: #dc2626;
        }
        
        /* Comparison table styles */
        .comparison-table {
            overflow-x: auto;
        }
        .comparison-table table {
            border-collapse: collapse;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #d1d5db;
            padding: 0.75rem;
            text-align: left;
        }
        .comparison-table th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        .comparison-table .pro {
            color: #059669;
        }
        .comparison-table .con {
            color: #dc2626;
        }

        /* Ensure sidebar layout works */
        .flex.gap-8 {
            display: flex !important;
            gap: 2rem !important;
            align-items: flex-start !important;
        }
        .flex-1 {
            flex: 1 !important;
            min-width: 0 !important;
        }
        .w-80 {
            width: 20rem !important;
            flex-shrink: 0 !important;
        }
    </style>
</head>
<body class="text-stone-800">

    <!-- Progress Tracker -->
    <div class="bg-white border-b border-stone-200 sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <span class="text-sm font-medium text-stone-600">Learning Progress:</span>
                    <div class="w-32 bg-stone-200 rounded-full h-2">
                        <div id="overall-progress" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
                    </div>
                    <span id="progress-text" class="text-sm text-stone-600">0% Complete</span>
                </div>
                <button onclick="resetProgress()" class="text-xs text-red-600 hover:text-red-700 font-medium">
                    Reset Progress
                </button>
            </div>
        </div>
    </div>

    <header class="bg-white shadow-md sticky top-8 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 text-sm text-stone-500">
                        <a href="index.html" class="hover:text-green-600 font-medium">Learning Hub</a>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                        <a href="foundations.html" class="hover:text-green-600 font-medium">Module 1</a>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                        <span class="text-green-600 font-medium">Module 2: Bioassay</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="openFeedbackAdminDashboard()" class="text-stone-400 hover:text-blue-600 text-sm font-medium" title="Feedback Admin">
                        üõ†Ô∏è Admin
                    </button>
                    <a href="intake-assessment.html" class="hidden md:inline-flex items-center text-stone-600 hover:text-green-600 font-medium">
                        Next: Intake Assessment
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                </div>
            </div>
            <div class="border-t border-stone-200 pt-4">
                <h1 class="text-3xl font-bold text-stone-900 mb-2">Module 2: Bioassay - Obtaining Reliable Measurements</h1>
                <p class="text-stone-600 mb-4">Master Step 1 of the internal dosimetry process: detecting and quantifying internal contamination</p>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- Module Introduction -->
            <div class="mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border-l-4 border-green-400">
                <h2 class="text-2xl font-bold mb-4 text-green-800">üéØ Module 2 Learning Objectives</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="space-y-2">
                        <h3 class="font-semibold text-green-800">By the end of this module, you will:</h3>
                        <ul class="text-green-700 text-sm space-y-1">
                            <li>‚úì Understand in vitro vs in vivo bioassay approaches</li>
                            <li>‚úì Master statistical concepts: DL, MDA, precision vs accuracy</li>
                            <li>‚úì Know when to use each bioassay method</li>
                            <li>‚úì Understand quality assurance requirements</li>
                        </ul>
                    </div>
                    <div class="bg-white p-4 rounded-lg border border-green-200">
                        <h3 class="font-bold text-green-800 mb-2">üî¨ Critical Foundation</h3>
                        <p class="text-sm text-green-600">Bioassay provides the fundamental data that drives all internal dosimetry. Without reliable measurements, everything else fails.</p>
                    </div>
                </div>
            </div>

            <!-- Section 1: What is Bioassay? -->
            <section id="section-1" class="progress-section mb-8 p-6 border-l-4 border-stone-300 bg-stone-50 rounded-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-stone-900">1. What is Bioassay?</h2>
                    <div class="flex items-center space-x-2">
                        <div id="section-1-status" class="w-6 h-6 rounded-full border-2 border-stone-300 flex items-center justify-center">
                            <span class="text-xs font-bold text-stone-400">1</span>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400 mb-4">
                        <p class="text-green-800 font-medium">Definition: <span class="glossary-term" data-term="radiobioassay">Radiobioassay</span> is the measurement of radioactive material in the body or in biological samples to assess internal contamination.</p>
                    </div>
                    <p class="text-lg mb-4">Bioassay is our only direct evidence of internal contamination. It provides the fundamental data that drives everything else in internal dosimetry - without reliable measurements, we cannot estimate intake or calculate dose.</p>
                    
                    <div class="bg-amber-50 p-4 rounded-lg border border-amber-200 mb-4">
                        <h3 class="font-bold text-amber-800 mb-2">üîë Key Insight</h3>
                        <p class="text-amber-700">The quality of bioassay measurements directly determines the accuracy of dose assessments. A small error in measurement can lead to large errors in final dose estimates.</p>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-3">When is Bioassay Required?</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                            <h4 class="font-bold text-red-800 mb-2">üö® Incident Response</h4>
                            <ul class="text-red-700 text-sm space-y-1">
                                <li>‚Ä¢ Suspected or confirmed intake</li>
                                <li>‚Ä¢ Contamination events</li>
                                <li>‚Ä¢ Lost source scenarios</li>
                                <li>‚Ä¢ Equipment failures</li>
                            </ul>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h4 class="font-bold text-blue-800 mb-2">üìä Routine Monitoring</h4>
                            <ul class="text-blue-700 text-sm space-y-1">
                                <li>‚Ä¢ Workers handling unsealed sources</li>
                                <li>‚Ä¢ High-risk operations</li>
                                <li>‚Ä¢ Regulatory compliance</li>
                                <li>‚Ä¢ Program effectiveness verification</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <button id="section-1-complete-btn" onclick="markSectionComplete('section-1')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                        Mark Section Complete
                    </button>
                    <button id="section-1-reset-btn" onclick="unmarkSection('section-1')" class="hidden ml-2 text-stone-500 hover:text-red-600 text-sm px-3 py-1 border border-stone-300 rounded hover:border-red-300 transition-colors">
                        Reset Section
                    </button>
                </div>
            </section>

            <!-- Section 2: In Vitro vs In Vivo Approaches -->
            <section id="section-2" class="progress-section mb-8 p-6 border-l-4 border-stone-300 bg-stone-50 rounded-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-stone-900">2. In Vitro vs In Vivo Approaches</h2>
                    <div class="flex items-center space-x-2">
                        <div id="section-2-status" class="w-6 h-6 rounded-full border-2 border-stone-300 flex items-center justify-center">
                            <span class="text-xs font-bold text-stone-400">2</span>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                            <h3 class="font-bold text-blue-800 mb-3 flex items-center">
                                <span class="mr-2">üî¨</span>
                                <span class="glossary-term" data-term="in-vitro">In Vitro Bioassay</span>
                            </h3>
                            <p class="text-blue-700 mb-3"><strong>Laboratory analysis</strong> of biological samples</p>
                            <h4 class="font-semibold text-blue-800 mb-2">Sample Types:</h4>
                            <ul class="list-disc list-inside text-blue-600 text-sm space-y-1 mb-3">
                                <li>Urine samples (most common)</li>
                                <li>Fecal samples</li>
                                <li>Blood samples</li>
                                <li>Breath samples (e.g., tritium)</li>
                                <li>Wound drainage</li>
                            </ul>
                            <div class="bg-blue-100 p-3 rounded">
                                <p class="text-blue-800 text-sm"><strong>Best for:</strong> Soluble materials, metabolized compounds, alpha emitters</p>
                            </div>
                        </div>
                        
                        <div class="bg-amber-50 p-6 rounded-lg border border-amber-200">
                            <h3 class="font-bold text-amber-800 mb-3 flex items-center">
                                <span class="mr-2">üì°</span>
                                <span class="glossary-term" data-term="in-vivo">In Vivo Bioassay</span>
                            </h3>
                            <p class="text-amber-700 mb-3"><strong>Direct measurement</strong> of radioactivity in the body</p>
                            <h4 class="font-semibold text-amber-800 mb-2">Methods:</h4>
                            <ul class="list-disc list-inside text-amber-600 text-sm space-y-1 mb-3">
                                <li>Whole body counting (WBC)</li>
                                <li>Lung counting</li>
                                <li>Thyroid counting</li>
                                <li>Wound counting</li>
                                <li>Lymph node counting</li>
                            </ul>
                            <div class="bg-amber-100 p-3 rounded">
                                <p class="text-amber-800 text-sm"><strong>Best for:</strong> Gamma emitters, insoluble materials, lung burdens</p>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="dive-deeper-btn mb-4" onclick="toggleDeepDive('comparison-table')">
                    üîç Dive Deeper: Detailed Comparison & Selection Criteria
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>

                <div id="comparison-table" class="deep-dive-content hidden mb-4">
                    <h4 class="font-semibold mb-3">Detailed Comparison: In Vitro vs In Vivo</h4>
                    <div class="comparison-table">
                        <table class="w-full text-sm">
                            <thead>
                                <tr>
                                    <th class="w-1/4">Factor</th>
                                    <th class="w-3/8">In Vitro Bioassay</th>
                                    <th class="w-3/8">In Vivo Bioassay</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="font-semibold">Detection Capability</td>
                                    <td><span class="pro">‚úì Excellent for alpha emitters</span><br><span class="pro">‚úì Very low detection limits</span></td>
                                    <td><span class="con">‚úó Cannot detect alpha/beta</span><br><span class="pro">‚úì Good for gamma emitters</span></td>
                                </tr>
                                <tr>
                                    <td class="font-semibold">Sample Collection</td>
                                    <td><span class="con">‚úó Subject to collection errors</span><br><span class="con">‚úó Incomplete collections</span></td>
                                    <td><span class="pro">‚úì No collection issues</span><br><span class="pro">‚úì Immediate results</span></td>
                                </tr>
                                <tr>
                                    <td class="font-semibold">Interference</td>
                                    <td><span class="con">‚úó Natural excretion variability</span><br><span class="con">‚úó Metabolic factors</span></td>
                                    <td><span class="con">‚úó Background radiation</span><br><span class="con">‚úó Body habitus effects</span></td>
                                </tr>
                                <tr>
                                    <td class="font-semibold">Time Requirements</td>
                                    <td><span class="con">‚úó Days to weeks for results</span><br><span class="con">‚úó Laboratory processing</span></td>
                                    <td><span class="pro">‚úì Immediate results</span><br><span class="pro">‚úì Real-time monitoring</span></td>
                                </tr>
                                <tr>
                                    <td class="font-semibold">Cost</td>
                                    <td><span class="con">‚úó Higher per sample</span><br><span class="con">‚úó Laboratory overhead</span></td>
                                    <td><span class="pro">‚úì Lower operating costs</span><br><span class="con">‚úó High capital investment</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mt-6">
                    <button id="section-2-complete-btn" onclick="markSectionComplete('section-2')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                        Mark Section Complete
                    </button>
                    <button id="section-2-reset-btn" onclick="unmarkSection('section-2')" class="hidden ml-2 text-stone-500 hover:text-red-600 text-sm px-3 py-1 border border-stone-300 rounded hover:border-red-300 transition-colors">
                        Reset Section
                    </button>
                </div>
            </section>

            <!-- Section 3: Statistical Concepts -->
            <section id="section-3" class="progress-section mb-8 p-6 border-l-4 border-stone-300 bg-stone-50 rounded-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-stone-900">3. Statistical Concepts & Detection Limits</h2>
                    <div class="flex items-center space-x-2">
                        <div id="section-3-status" class="w-6 h-6 rounded-full border-2 border-stone-300 flex items-center justify-center">
                            <span class="text-xs font-bold text-stone-400">3</span>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-200 mb-4">
                        <h3 class="font-bold text-purple-800 mb-2">üéØ Critical Question</h3>
                        <p class="text-purple-700">Not all measurements indicate contamination. How do we distinguish between <strong>real contamination</strong> and <strong>measurement uncertainty</strong>?</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                            <h4 class="font-bold text-yellow-800 mb-2"><span class="glossary-term" data-term="decision-level">Decision Level (DL)</span></h4>
                            <p class="text-yellow-700 text-sm mb-2">Minimum measurement needed to conclude contamination is "detected" with confidence</p>
                            <div class="bg-yellow-100 p-2 rounded text-xs text-yellow-800">
                                <strong>Purpose:</strong> Prevents false positives due to counting statistics
                            </div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <h4 class="font-bold text-orange-800 mb-2"><span class="glossary-term" data-term="mda">Minimum Detectable Activity (MDA)</span></h4>
                            <p class="text-orange-700 text-sm mb-2">Smallest amount that can be reliably detected and quantified by the measurement system</p>
                            <div class="bg-orange-100 p-2 rounded text-xs text-orange-800">
                                <strong>Purpose:</strong> Defines measurement system capability
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-3">Precision vs Accuracy</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h4 class="font-bold text-blue-800 mb-2">Precision</h4>
                            <p class="text-blue-700 text-sm mb-2">Reproducibility of measurements (how close repeated measurements are to each other)</p>
                            <div class="bg-blue-100 p-2 rounded text-xs text-blue-800">
                                <strong>Affected by:</strong> Counting statistics, instrument stability, sample preparation consistency
                            </div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <h4 class="font-bold text-green-800 mb-2">Accuracy</h4>
                            <p class="text-green-700 text-sm mb-2">How close measurements are to the true value</p>
                            <div class="bg-green-100 p-2 rounded text-xs text-green-800">
                                <strong>Affected by:</strong> Calibration errors, systematic biases, matrix effects
                            </div>
                        </div>
                    </div>
                </div>

                <button class="dive-deeper-btn mb-4" onclick="toggleDeepDive('currie-limits')">
                    üîç Dive Deeper: Currie Detection Limits & Error Propagation
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>

                <div id="currie-limits" class="deep-dive-content hidden mb-4">
                    <h4 class="font-semibold mb-3">Currie Detection Limits (1968)</h4>
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded border border-purple-300">
                            <h5 class="font-semibold text-purple-800 mb-2">Critical Level (LC)</h5>
                            <p class="text-purple-700 text-sm mb-2">LC = 1.645 √ó ‚àö(2 √ó Background)</p>
                            <p class="text-purple-600 text-xs">Decision threshold - if measurement > LC, signal is "detected"</p>
                        </div>
                        <div class="bg-white p-4 rounded border border-purple-300">
                            <h5 class="font-semibold text-purple-800 mb-2">Detection Limit (LD)</h5>
                            <p class="text-purple-700 text-sm mb-2">LD = 2.71 + 4.65 √ó ‚àöBackground</p>
                            <p class="text-purple-600 text-xs">Minimum activity that can be detected with 95% confidence</p>
                        </div>
                        <div class="bg-white p-4 rounded border border-purple-300">
                            <h5 class="font-semibold text-purple-800 mb-2">Quantification Limit (LQ)</h5>
                            <p class="text-purple-700 text-sm mb-2">LQ ‚âà 10 √ó ‚àöBackground</p>
                            <p class="text-purple-600 text-xs">Minimum activity for reliable quantitative analysis (typically 10% precision)</p>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <button id="section-3-complete-btn" onclick="markSectionComplete('section-3')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                        Mark Section Complete
                    </button>
                    <button id="section-3-reset-btn" onclick="unmarkSection('section-3')" class="hidden ml-2 text-stone-500 hover:text-red-600 text-sm px-3 py-1 border border-stone-300 rounded hover:border-red-300 transition-colors">
                        Reset Section
                    </button>
                </div>
            </section>

            <!-- Section 4: Quality Assurance -->
            <section id="section-4" class="progress-section mb-8 p-6 border-l-4 border-stone-300 bg-stone-50 rounded-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-stone-900">4. Quality Assurance & Accreditation</h2>
                    <div class="flex items-center space-x-2">
                        <div id="section-4-status" class="w-6 h-6 rounded-full border-2 border-stone-300 flex items-center justify-center">
                            <span class="text-xs font-bold text-stone-400">4</span>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-4">
                        <h3 class="font-bold text-blue-800 mb-2">üìã Regulatory Requirements by Facility Type</h3>
                        <div class="text-blue-700 space-y-2">
                            <p><strong>DOE Facilities & Contractors:</strong> Must use DOELAP-accredited bioassay laboratories</p>
                            <p><strong>NRC Licensees (Materials Licenses, Nuclear Power Plants):</strong> Must use NVLAP-accredited laboratories for personnel dosimetry (10 CFR 20.1501(d)). Bioassay lab accreditation requirements may vary by license conditions</p>
                            <p><strong>International Facilities:</strong> Should follow applicable national standards and internationally recognized accreditation programs</p>
                            <p><strong>All Facilities:</strong> Must participate in regular proficiency testing and maintain quality assurance programs</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-xl font-semibold mb-3">Accreditation Requirements by Facility</h3>
                            <ul class="space-y-3 text-sm">
                                <li class="flex items-start">
                                    <span class="text-blue-500 mr-2 font-bold">DOE:</span>
                                    <div>
                                        <strong>DOELAP Required:</strong> Department of Energy Laboratory Accreditation Program for bioassay and radiobioassay services
                                    </div>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-green-500 mr-2 font-bold">NRC:</span>
                                    <div>
                                        <strong>NVLAP Required:</strong> For personnel dosimetry (10 CFR 20.1501(d)). Bioassay may require NVLAP or equivalent per license conditions
                                    </div>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-purple-500 mr-2 font-bold">INT:</span>
                                    <div>
                                        <strong>International Standards:</strong> ISO/IEC 17025 or equivalent national accreditation programs
                                    </div>
                                </li>
                            </ul>
                            
                            <h4 class="text-lg font-semibold mt-4 mb-2">General Requirements (All Facilities)</h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start">
                                    <span class="text-green-500 mr-2">‚úì</span>
                                    <div>
                                        <strong>Proficiency Testing:</strong> Regular participation in performance testing programs
                                    </div>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-green-500 mr-2">‚úì</span>
                                    <div>
                                        <strong>Calibration Standards:</strong> Traceable to national standards (NIST)
                                    </div>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-green-500 mr-2">‚úì</span>
                                    <div>
                                        <strong>Quality Management:</strong> ISO/IEC 17025 or equivalent quality system
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <div>
                            <h3 class="text-xl font-semibold mb-3">Common QC Issues</h3>
                            <div class="space-y-3">
                                <div class="bg-yellow-50 p-3 rounded border border-yellow-200">
                                    <h4 class="font-semibold text-yellow-800 text-sm">Sample Collection</h4>
                                    <ul class="text-yellow-700 text-xs space-y-1 mt-1">
                                        <li>‚Ä¢ Incomplete urine collections</li>
                                        <li>‚Ä¢ Cross-contamination</li>
                                        <li>‚Ä¢ Timing errors</li>
                                    </ul>
                                </div>
                                <div class="bg-orange-50 p-3 rounded border border-orange-200">
                                    <h4 class="font-semibold text-orange-800 text-sm">Laboratory Processing</h4>
                                    <ul class="text-orange-700 text-xs space-y-1 mt-1">
                                        <li>‚Ä¢ Chemical yield variations</li>
                                        <li>‚Ä¢ Matrix interference</li>
                                        <li>‚Ä¢ Instrument drift</li>
                                    </ul>
                                </div>
                                <div class="bg-red-50 p-3 rounded border border-red-200">
                                    <h4 class="font-semibold text-red-800 text-sm">Reporting</h4>
                                    <ul class="text-red-700 text-xs space-y-1 mt-1">
                                        <li>‚Ä¢ Unit conversion errors</li>
                                        <li>‚Ä¢ Detection limit misapplication</li>
                                        <li>‚Ä¢ Uncertainty underestimation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <button id="section-4-complete-btn" onclick="markSectionComplete('section-4')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                        Mark Section Complete
                    </button>
                    <button id="section-4-reset-btn" onclick="unmarkSection('section-4')" class="hidden ml-2 text-stone-500 hover:text-red-600 text-sm px-3 py-1 border border-stone-300 rounded hover:border-red-300 transition-colors">
                        Reset Section
                    </button>
                </div>
            </section>

            <!-- Knowledge Check Quiz -->
            <section id="knowledge-check" class="mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200">
                <h2 class="text-2xl font-bold mb-4 text-green-800">üß† Knowledge Check</h2>
                <p class="text-green-700 mb-6">Test your understanding of bioassay concepts before moving to the next module!</p>
                
                <div id="quiz-container">
                    <!-- Quiz Question 1 -->
                    <div id="question-1" class="quiz-question active">
                        <h3 class="text-lg font-semibold mb-4 text-stone-800">Question 1 of 4</h3>
                        <p class="text-stone-700 mb-4">A worker potentially exposed to Pu-239 needs bioassay. Which approach would be MOST appropriate and why?</p>
                        <div class="space-y-2">
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="1" data-option="A">
                                <span class="font-semibold">A)</span> In vitro urine bioassay because Pu-239 is an alpha emitter that cannot be detected by external counting
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="1" data-option="B">
                                <span class="font-semibold">B)</span> In vivo bioassay because it gives immediate results
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="1" data-option="C">
                                <span class="font-semibold">C)</span> Either method would work equally well
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="1" data-option="D">
                                <span class="font-semibold">D)</span> In vivo bioassay because it's more accurate
                            </div>
                        </div>
                        <div id="explanation-1" class="hidden mt-4 p-3 bg-green-50 border border-green-200 rounded">
                            <p class="text-green-800 text-sm"><strong>Correct!</strong> Pu-239 is an alpha emitter with very short range. Alpha particles cannot penetrate tissue to reach external detectors, making in vivo counting ineffective. In vitro urine analysis is the standard approach for alpha-emitting transuranics.</p>
                        </div>
                    </div>

                    <!-- Quiz Question 2 -->
                    <div id="question-2" class="quiz-question">
                        <h3 class="text-lg font-semibold mb-4 text-stone-800">Question 2 of 4</h3>
                        <p class="text-stone-700 mb-4">A bioassay measurement shows 15 ¬± 3 dpm above background. The decision level (DL) is 10 dpm and the MDA is 20 dpm. How should this result be interpreted?</p>
                        <div class="space-y-2">
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="2" data-option="A">
                                <span class="font-semibold">A)</span> Contamination is detected and can be reliably quantified
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="2" data-option="B" onclick="selectQuizOption(this)">
                                <span class="font-semibold">B)</span> Contamination is detected but cannot be reliably quantified
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="2" data-option="C">
                                <span class="font-semibold">C)</span> No contamination detected
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="2" data-option="D">
                                <span class="font-semibold">D)</span> Result is inconclusive due to high uncertainty
                            </div>
                        </div>
                        <div id="explanation-2" class="hidden mt-4 p-3 bg-green-50 border border-green-200 rounded">
                            <p class="text-green-800 text-sm"><strong>Correct!</strong> The measurement (15 dpm) exceeds the decision level (10 dpm), so contamination is "detected." However, it's below the MDA (20 dpm), meaning while we can say contamination is present, we cannot reliably quantify the amount with acceptable precision.</p>
                        </div>
                    </div>

                    <!-- Quiz Question 3 -->
                    <div id="question-3" class="quiz-question">
                        <h3 class="text-lg font-semibold mb-4 text-stone-800">Question 3 of 4</h3>
                        <p class="text-stone-700 mb-4">Two laboratories analyze identical samples. Lab A consistently reports results within 5% of each other but 20% higher than the true value. Lab B's results vary by 25% but average to the true value. Which statement is correct?</p>
                        <div class="space-y-2">
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="3" data-option="A">
                                <span class="font-semibold">A)</span> Lab A is more accurate and more precise
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="3" data-option="B">
                                <span class="font-semibold">B)</span> Lab A is more precise but less accurate; Lab B is more accurate but less precise
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="3" data-option="C">
                                <span class="font-semibold">C)</span> Lab B is both more accurate and more precise
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="3" data-option="D">
                                <span class="font-semibold">D)</span> Both labs have equal accuracy and precision
                            </div>
                        </div>
                        <div id="explanation-3" class="hidden mt-4 p-3 bg-green-50 border border-green-200 rounded">
                            <p class="text-green-800 text-sm"><strong>Correct!</strong> Lab A is precise (consistent results) but inaccurate (systematic 20% bias). Lab B is accurate (average equals true value) but imprecise (high variability). This illustrates that precision and accuracy are independent concepts.</p>
                        </div>
                    </div>

                    <!-- Quiz Question 4 -->
                    <div id="question-4" class="quiz-question">
                        <h3 class="text-lg font-semibold mb-4 text-stone-800">Question 4 of 4</h3>
                        <p class="text-stone-700 mb-4">Why is laboratory accreditation (DOELAP/NVLAP) required for bioassay laboratories rather than just being "recommended"?</p>
                        <div class="space-y-2">
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="4" data-option="A">
                                <span class="font-semibold">A)</span> Because bioassay results directly impact regulatory compliance and worker health decisions
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="4" data-option="B">
                                <span class="font-semibold">B)</span> It ensures laboratories use the most advanced equipment
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="4" data-option="C">
                                <span class="font-semibold">C)</span> To reduce costs by standardizing procedures
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="4" data-option="D">
                                <span class="font-semibold">D)</span> It's only required for government facilities
                            </div>
                        </div>
                        <div id="explanation-4" class="hidden mt-4 p-3 bg-green-50 border border-green-200 rounded">
                            <p class="text-green-800 text-sm"><strong>Correct!</strong> Bioassay results form the basis for critical decisions about worker dose limits, medical intervention, work restrictions, and regulatory compliance. Errors can have serious health and legal consequences, making accredited quality assurance essential, not optional.</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between items-center mt-6">
                    <div class="flex space-x-2">
                        <button id="prev-question" class="px-4 py-2 bg-stone-500 text-white rounded hover:bg-stone-600 transition-colors disabled:opacity-50" disabled>
                            Previous
                        </button>
                        <button onclick="resetQuiz()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors text-sm">
                            Reset Quiz
                        </button>
                    </div>
                    <div class="flex space-x-2">
                        <span id="question-indicator" class="px-3 py-1 bg-green-100 text-green-800 rounded text-sm">Question 1 of 4</span>
                    </div>
                    <button id="next-question" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
                        Next Question
                    </button>
                </div>

                <div id="quiz-complete" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded">
                    <h3 class="text-lg font-semibold text-green-800 mb-2">üéâ Module 2 Complete!</h3>
                    <p class="text-green-700 mb-4">Excellent work! You've mastered bioassay fundamentals. You're ready to learn how measurements connect to intake estimates.</p>
                    <a href="intake-assessment.html" class="inline-block bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition-colors">
                        Continue to Module 3: Intake Assessment ‚Üí
                    </a>
                </div>
            </section>

            <!-- Module Summary -->
            <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                <h2 class="text-xl font-bold text-green-800 mb-3">üìö Module 2 Summary</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <h3 class="font-semibold text-green-800 mb-2">Key Concepts Mastered:</h3>
                        <ul class="text-green-700 space-y-1">
                            <li>‚Ä¢ In vitro vs in vivo bioassay selection</li>
                            <li>‚Ä¢ Statistical detection concepts (DL, MDA)</li>
                            <li>‚Ä¢ Precision vs accuracy understanding</li>
                            <li>‚Ä¢ Quality assurance requirements</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-semibold text-green-800 mb-2">Ready for Next Module:</h3>
                        <p class="text-green-700">You now understand how to obtain reliable measurements. Next, we'll explore how biokinetic models convert these measurements into intake estimates.</p>
                    </div>
                </div>
            </div>
            
            </div>
            
    </main>

    <script>
        // Progress tracking
        let sectionProgress = {
            'section-1': false,
            'section-2': false,
            'section-3': false,
            'section-4': false,
            'quiz': false
        };

        // Quiz state
        let currentQuestion = 1;
        let quizAnswers = {};
        const correctAnswers = { 1: 'A', 2: 'B', 3: 'B', 4: 'A' };

        // Load progress from localStorage
        function loadProgress() {
            const saved = localStorage.getItem('bioassay-progress');
            if (saved) {
                sectionProgress = { ...sectionProgress, ...JSON.parse(saved) };
                updateProgressDisplay();
                updateSectionVisuals();
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            localStorage.setItem('bioassay-progress', JSON.stringify(sectionProgress));
        }

        // Mark section complete
        function markSection(sectionId) {
            markSectionComplete(sectionId);
        }

        // Mark section as complete
        function markSectionComplete(sectionId) {
            sectionProgress[sectionId] = true;
            saveProgress();
            updateProgressDisplay();
            updateSectionVisuals();
            
            // Visual feedback
            const section = document.getElementById(sectionId);
            section.classList.add('completed');
            
            // Animate status indicator
            const status = document.getElementById(sectionId + '-status');
            status.innerHTML = '<svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>';
            status.style.backgroundColor = '#10b981';
            status.style.borderColor = '#10b981';
            
            // Update button states
            const completeBtn = document.getElementById(sectionId + '-complete-btn');
            const resetBtn = document.getElementById(sectionId + '-reset-btn');
            
            if (completeBtn) {
                completeBtn.classList.add('bg-stone-400', 'cursor-not-allowed');
                completeBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                completeBtn.disabled = true;
                completeBtn.innerHTML = '‚úì Section Complete';
            }
            
            if (resetBtn) {
                resetBtn.classList.remove('hidden');
            }
        }

        // Unmark section (allow users to reset individual sections)
        function unmarkSection(sectionId) {
            sectionProgress[sectionId] = false;
            saveProgress();
            updateProgressDisplay();
            updateSectionVisuals();
            
            // Reset visual state
            const section = document.getElementById(sectionId);
            section.classList.remove('completed');
            
            // Reset status indicator
            const status = document.getElementById(sectionId + '-status');
            const sectionNumber = sectionId.split('-')[1];
            status.innerHTML = `<span class="text-xs font-bold text-stone-400">${sectionNumber}</span>`;
            status.style.backgroundColor = '';
            status.style.borderColor = '#d1d5db';
            
            // Reset button states
            const completeBtn = document.getElementById(sectionId + '-complete-btn');
            const resetBtn = document.getElementById(sectionId + '-reset-btn');
            
            if (completeBtn) {
                completeBtn.classList.remove('bg-stone-400', 'cursor-not-allowed');
                completeBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                completeBtn.disabled = false;
                completeBtn.innerHTML = 'Mark Section Complete';
            }
            
            if (resetBtn) {
                resetBtn.classList.add('hidden');
            }
        }

        // Reset all progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress for this module? This cannot be undone.')) {
                // Reset progress object
                Object.keys(sectionProgress).forEach(key => {
                    sectionProgress[key] = false;
                });
                
                // Reset quiz state
                currentQuestion = 1;
                quizAnswers = {};
                
                // Save and update display
                saveProgress();
                updateProgressDisplay();
                updateSectionVisuals();
                
                // Reset quiz interface if visible
                if (!document.getElementById('quiz-complete').classList.contains('hidden')) {
                    document.getElementById('quiz-container').style.display = 'block';
                    document.getElementById('quiz-complete').classList.add('hidden');
                    
                    // Reset to first question
                    document.querySelectorAll('.quiz-question').forEach(q => q.classList.remove('active'));
                    document.getElementById('question-1').classList.add('active');
                    
                    // Reset question indicators
                    document.querySelectorAll('[id$="-indicator"]').forEach(indicator => {
                        indicator.classList.remove('bg-blue-500', 'bg-green-500');
                        indicator.classList.add('bg-stone-300');
                    });
                    document.getElementById('q1-indicator').classList.add('bg-blue-500');
                    
                    // Reset navigation buttons
                    document.getElementById('prev-question').disabled = true;
                    document.getElementById('next-question').disabled = true;
                    document.getElementById('next-question').textContent = 'Next';
                    
                    // Clear all quiz selections and explanations
                    document.querySelectorAll('.quiz-option').forEach(option => {
                        option.classList.remove('selected', 'correct', 'incorrect');
                    });
                    document.querySelectorAll('[id^="explanation-"]').forEach(explanation => {
                        explanation.classList.add('hidden');
                    });
                }
                
                alert('Progress has been reset successfully!');
            }
        }

        // Reset quiz only
        function resetQuizOnly() {
            if (confirm('Reset quiz progress? This will clear your quiz answers and allow you to retake it.')) {
                sectionProgress['quiz'] = false;
                currentQuestion = 1;
                quizAnswers = {};
                
                saveProgress();
                updateProgressDisplay();
                updateSectionVisuals();
                
                // Reset quiz interface if visible
                if (!document.getElementById('quiz-complete').classList.contains('hidden')) {
                    document.getElementById('quiz-container').style.display = 'block';
                    document.getElementById('quiz-complete').classList.add('hidden');
                    
                    // Reset to first question
                    document.querySelectorAll('.quiz-question').forEach(q => q.classList.remove('active'));
                    document.getElementById('question-1').classList.add('active');
                    
                    // Reset question indicators
                    document.querySelectorAll('[id$="-indicator"]').forEach(indicator => {
                        indicator.classList.remove('bg-blue-500', 'bg-green-500');
                        indicator.classList.add('bg-stone-300');
                    });
                    document.getElementById('q1-indicator').classList.add('bg-blue-500');
                    
                    // Reset navigation buttons
                    document.getElementById('prev-question').disabled = true;
                    document.getElementById('next-question').disabled = true;
                    document.getElementById('next-question').textContent = 'Next';
                    
                    // Clear all quiz selections and explanations
                    document.querySelectorAll('.quiz-option').forEach(option => {
                        option.classList.remove('selected', 'correct', 'incorrect');
                    });
                    document.querySelectorAll('[id^="explanation-"]').forEach(explanation => {
                        explanation.classList.add('hidden');
                    });
                }
                
                closeProgressModal();
            }
        }

        // Toggle sidebar visibility
        function toggleSidebar() {
            const content = document.getElementById('sidebar-content');
            const toggle = document.getElementById('sidebar-toggle');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = '‚àí';
            } else {
                content.style.display = 'none';
                toggle.textContent = '+';
            }
        }

        // Reset all progress (alternative function for sidebar)
        function resetAllProgress() {
            resetProgress();
        }

        // Update sidebar progress display
        function updateSidebarProgress() {
            const completed = Object.values(sectionProgress).filter(Boolean).length;
            const total = Object.keys(sectionProgress).length;
            
            // Update overall progress in sidebar
            const sidebarProgress = document.getElementById('overall-progress-sidebar');
            if (sidebarProgress) {
                sidebarProgress.textContent = `${completed}/${total} Complete`;
            }
            
            // Update section checklist
            const checklist = document.getElementById('section-checklist');
            if (checklist) {
                checklist.innerHTML = `
                    <div class="flex items-center justify-between py-1">
                        <div class="flex items-center">
                            <span class="${sectionProgress['section-1'] ? 'text-blue-600' : 'text-stone-400'}">${sectionProgress['section-1'] ? '‚úì' : '‚óã'}</span>
                            <span class="ml-2 text-sm">In Vitro vs In Vivo</span>
                        </div>
                        ${sectionProgress['section-1'] ? '<button onclick="unmarkSection(\'section-1\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                    </div>
                    <div class="flex items-center justify-between py-1">
                        <div class="flex items-center">
                            <span class="${sectionProgress['section-2'] ? 'text-blue-600' : 'text-stone-400'}">${sectionProgress['section-2'] ? '‚úì' : '‚óã'}</span>
                            <span class="ml-2 text-sm">Detection & Statistics</span>
                        </div>
                        ${sectionProgress['section-2'] ? '<button onclick="unmarkSection(\'section-2\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                    </div>
                    <div class="flex items-center justify-between py-1">
                        <div class="flex items-center">
                            <span class="${sectionProgress['section-3'] ? 'text-blue-600' : 'text-stone-400'}">${sectionProgress['section-3'] ? '‚úì' : '‚óã'}</span>
                            <span class="ml-2 text-sm">Precision vs Accuracy</span>
                        </div>
                        ${sectionProgress['section-3'] ? '<button onclick="unmarkSection(\'section-3\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                    </div>
                    <div class="flex items-center justify-between py-1">
                        <div class="flex items-center">
                            <span class="${sectionProgress['section-4'] ? 'text-blue-600' : 'text-stone-400'}">${sectionProgress['section-4'] ? '‚úì' : '‚óã'}</span>
                            <span class="ml-2 text-sm">Quality Assurance</span>
                        </div>
                        ${sectionProgress['section-4'] ? '<button onclick="unmarkSection(\'section-4\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                    </div>
                    <div class="flex items-center justify-between py-1">
                        <div class="flex items-center">
                            <span class="${sectionProgress['quiz'] ? 'text-blue-600' : 'text-stone-400'}">${sectionProgress['quiz'] ? '‚úì' : '‚óã'}</span>
                            <span class="ml-2 text-sm">Knowledge Check Quiz</span>
                        </div>
                        ${sectionProgress['quiz'] ? '<button onclick="resetQuizOnly()" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                    </div>
                `;
            }
        }

        // Reset quiz only
        function resetQuizOnly() {
            if (confirm('Reset quiz progress? This will clear your quiz answers and allow you to retake it.')) {
                sectionProgress['quiz'] = false;
                currentQuestion = 1;
                quizAnswers = {};
                
                saveProgress();
                updateProgressDisplay();
                updateSectionVisuals();
                
                // Reset quiz interface if visible
                if (!document.getElementById('quiz-complete').classList.contains('hidden')) {
                    document.getElementById('quiz-container').style.display = 'block';
                    document.getElementById('quiz-complete').classList.add('hidden');
                    
                    // Reset to first question
                    document.querySelectorAll('.quiz-question').forEach(q => q.classList.remove('active'));
                    document.getElementById('question-1').classList.add('active');
                    
                    // Reset navigation buttons
                    document.getElementById('prev-question').disabled = true;
                    document.getElementById('next-question').disabled = true;
                    document.getElementById('next-question').textContent = 'Next';
                    
                    // Clear all quiz selections and explanations
                    document.querySelectorAll('.quiz-option').forEach(option => {
                        option.classList.remove('selected', 'correct', 'incorrect');
                    });
                    document.querySelectorAll('[id^="explanation-"]').forEach(explanation => {
                        explanation.classList.add('hidden');
                    });
                }
            }
        }

        // Update progress display
        function updateProgressDisplay() {
            const completed = Object.values(sectionProgress).filter(Boolean).length;
            const total = Object.keys(sectionProgress).length;
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('overall-progress').style.width = percentage + '%';
        function updateProgressDisplay() {
            const completed = Object.values(sectionProgress).filter(Boolean).length;
            const total = Object.keys(sectionProgress).length;
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('overall-progress').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = percentage + '% Complete';
            
            // CRITICAL: Always update sidebar
            updateSidebarProgress();
        }

        // Update section visual states
        function updateSectionVisuals() {
            Object.keys(sectionProgress).forEach(sectionId => {
                const section = document.getElementById(sectionId);
                const status = document.getElementById(sectionId + '-status');
                const completeBtn = document.getElementById(sectionId + '-complete-btn');
                const resetBtn = document.getElementById(sectionId + '-reset-btn');
                
                if (sectionProgress[sectionId]) {
                    if (section) section.classList.add('completed');
                    if (status) {
                        status.innerHTML = '<svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>';
                        status.style.backgroundColor = '#10b981';
                        status.style.borderColor = '#10b981';
                    }
                    if (completeBtn) {
                        completeBtn.classList.add('bg-stone-400', 'cursor-not-allowed');
                        completeBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                        completeBtn.disabled = true;
                        completeBtn.innerHTML = '‚úì Section Complete';
                    }
                    if (resetBtn) {
                        resetBtn.classList.remove('hidden');
                    }
                } else {
                    if (section) section.classList.remove('completed');
                    if (status) {
                        const sectionNumber = sectionId.split('-')[1];
                        status.innerHTML = `<span class="text-xs font-bold text-stone-400">${sectionNumber}</span>`;
                        status.style.backgroundColor = '';
                        status.style.borderColor = '#d1d5db';
                    }
                    if (completeBtn) {
                        completeBtn.classList.remove('bg-stone-400', 'cursor-not-allowed');
                        completeBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                        completeBtn.disabled = false;
                        completeBtn.innerHTML = 'Mark Section Complete';
                    }
                    if (resetBtn) {
                        resetBtn.classList.add('hidden');
                    }
                }
            });
        }

        // Show/hide deep dive content
        function toggleDeepDive(contentId) {
            const content = document.getElementById(contentId);
            content.classList.toggle('hidden');
        }

        // Progress detail modal
        function showProgressDetail() {
            const completed = Object.values(sectionProgress).filter(Boolean).length;
            const total = Object.keys(sectionProgress).length;
            
            const details = `
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span>Section 1: What is Bioassay?</span>
                        <div class="flex items-center space-x-2">
                            <span class="${sectionProgress['section-1'] ? 'text-green-600' : 'text-stone-400'}">${sectionProgress['section-1'] ? '‚úì' : '‚óã'}</span>
                            ${sectionProgress['section-1'] ? '<button onclick="unmarkSection(\'section-1\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Section 2: In Vitro vs In Vivo</span>
                        <div class="flex items-center space-x-2">
                            <span class="${sectionProgress['section-2'] ? 'text-green-600' : 'text-stone-400'}">${sectionProgress['section-2'] ? '‚úì' : '‚óã'}</span>
                            ${sectionProgress['section-2'] ? '<button onclick="unmarkSection(\'section-2\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Section 3: Statistical Concepts</span>
                        <div class="flex items-center space-x-2">
                            <span class="${sectionProgress['section-3'] ? 'text-green-600' : 'text-stone-400'}">${sectionProgress['section-3'] ? '‚úì' : '‚óã'}</span>
                            ${sectionProgress['section-3'] ? '<button onclick="unmarkSection(\'section-3\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Section 4: Quality Assurance</span>
                        <div class="flex items-center space-x-2">
                            <span class="${sectionProgress['section-4'] ? 'text-green-600' : 'text-stone-400'}">${sectionProgress['section-4'] ? '‚úì' : '‚óã'}</span>
                            ${sectionProgress['section-4'] ? '<button onclick="unmarkSection(\'section-4\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Knowledge Check Quiz</span>
                        <div class="flex items-center space-x-2">
                            <span class="${sectionProgress['quiz'] ? 'text-green-600' : 'text-stone-400'}">${sectionProgress['quiz'] ? '‚úì' : '‚óã'}</span>
                            ${sectionProgress['quiz'] ? '<button onclick="resetQuizOnly()" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                        </div>
                    </div>
                    <hr class="border-stone-200">
                    <div class="flex justify-between font-semibold">
                        <span>Overall Progress</span>
                        <span class="text-green-600">${completed}/${total} (${Math.round((completed/total)*100)}%)</span>
                    </div>
                    <div class="mt-4 pt-3 border-t border-stone-200">
                        <button onclick="resetProgress(); closeProgressModal();" class="w-full bg-red-50 text-red-700 px-3 py-2 rounded border border-red-200 hover:bg-red-100 transition-colors text-sm">
                            Reset All Progress
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('progressDetails').innerHTML = details;
            document.getElementById('progressModal').classList.remove('hidden');
        }

        function closeProgressModal() {
            document.getElementById('progressModal').classList.add('hidden');
        }

        // QUIZ SYSTEM - Corrected Template with Green Color Scheme
        let quizState = {
            currentQuestion: 1,
            totalQuestions: 4,
            answers: {},
            correctAnswers: { 1: 'A', 2: 'B', 3: 'B', 4: 'A' }
        };

        function initializeQuiz() {
            loadQuizState();
            setupQuizEventListeners();
            updateQuizDisplay();
            restoreQuizState();
        }

        function loadQuizState() {
            const saved = localStorage.getItem('bioassay-quiz');
            if (saved) {
                const savedState = JSON.parse(saved);
                quizState = { ...quizState, ...savedState };
            }
        }

        function saveQuizState() {
            localStorage.setItem('bioassay-quiz', JSON.stringify(quizState));
        }

        function setupQuizEventListeners() {
            // Add click handlers to quiz options
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function() {
                    const question = parseInt(this.getAttribute('data-question'));
                    const selectedOption = this.getAttribute('data-option');
                    selectQuizOption(question, selectedOption);
                });
            });

            // Add handlers to navigation buttons
            const prevBtn = document.getElementById('prev-question');
            const nextBtn = document.getElementById('next-question');
            
            if (prevBtn) prevBtn.addEventListener('click', previousQuestion);
            if (nextBtn) nextBtn.addEventListener('click', nextQuestion);
        }

        function selectQuizOption(questionNum, option) {
            // Store the answer
            quizState.answers[questionNum] = option;
            saveQuizState();
            
            // Remove previous selections for this question
            document.querySelectorAll(`[data-question="${questionNum}"]`).forEach(opt => {
                opt.classList.remove('border-blue-500', 'bg-blue-50', 'border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                opt.classList.add('border-stone-300');
            });
            
            // Highlight selected option
            const selectedElement = document.querySelector(`[data-question="${questionNum}"][data-option="${option}"]`);
            const isCorrect = option === quizState.correctAnswers[questionNum];
            
            if (isCorrect) {
                selectedElement.classList.remove('border-stone-300');
                selectedElement.classList.add('border-green-500', 'bg-green-50');
            } else {
                selectedElement.classList.remove('border-stone-300');
                selectedElement.classList.add('border-red-500', 'bg-red-50');
            }
            
            // Show explanation
            showQuizExplanation(questionNum, isCorrect);
        }

        function showQuizExplanation(questionNum, isCorrect) {
            const explanation = document.getElementById(`explanation-${questionNum}`);
            if (!explanation) return;
            
            explanation.classList.remove('hidden');
            
            if (isCorrect) {
                explanation.classList.remove('bg-red-50', 'border-red-200');
                explanation.classList.add('bg-green-50', 'border-green-200');
                const p = explanation.querySelector('p');
                if (p) p.className = 'text-green-800 text-sm';
            } else {
                explanation.classList.remove('bg-green-50', 'border-green-200');
                explanation.classList.add('bg-red-50', 'border-red-200');
                
                const correctAnswer = quizState.correctAnswers[questionNum];
                explanation.innerHTML = `
                    <p class="text-red-800 text-sm">
                        <strong>Incorrect.</strong> The correct answer is <strong>${correctAnswer}</strong>. 
                        ${getCorrectExplanation(questionNum)}
                    </p>
                `;
            }
        }

        function getCorrectExplanation(questionNum) {
            const explanations = {
                1: "Urine samples are preferred for tritium monitoring because tritium is rapidly incorporated into body water and excreted primarily through urine, making it the most sensitive matrix for detection.",
                2: "Detection limits in bioassay refer to the minimum amount of radioactive material that can be reliably measured by the analytical method, which is critical for establishing monitoring programs and regulatory compliance.",
                3: "MDA (Minimum Detectable Activity) represents the smallest amount of activity that can be detected with 95% confidence, accounting for background fluctuations and counting statistics.",
                4: "Chain of custody documentation is essential to maintain the legal and scientific integrity of bioassay samples, ensuring traceability from collection to analysis."
            };
            return explanations[questionNum] || "Review the material for the correct answer.";
        }

        function previousQuestion() {
            if (quizState.currentQuestion > 1) {
                quizState.currentQuestion--;
                saveQuizState();
                updateQuizDisplay();
            }
        }

        function nextQuestion() {
            if (quizState.currentQuestion < quizState.totalQuestions) {
                quizState.currentQuestion++;
                saveQuizState();
                updateQuizDisplay();
            } else {
                // Quiz complete
                alert('Quiz completed! Great job!');
                markSectionComplete('quiz');
            }
        }

        function updateQuizDisplay() {
            // Hide all explanations when changing questions - CRITICAL FIX
            document.querySelectorAll('[id^="explanation-"]').forEach(exp => {
                exp.classList.add('hidden');
            });
            
            // Update question indicator
            const indicator = document.getElementById('question-indicator');
            if (indicator) {
                indicator.textContent = `Question ${quizState.currentQuestion} of ${quizState.totalQuestions}`;
            }
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prev-question');
            const nextBtn = document.getElementById('next-question');
            
            if (prevBtn) {
                prevBtn.disabled = quizState.currentQuestion === 1;
            }
            
            if (nextBtn) {
                if (quizState.currentQuestion === quizState.totalQuestions) {
                    nextBtn.textContent = 'Finish Quiz';
                } else {
                    nextBtn.textContent = 'Next Question';
                }
            }
            
            // Show/hide questions
            for (let i = 1; i <= quizState.totalQuestions; i++) {
                const questionElement = document.getElementById(`question-${i}`);
                if (questionElement) {
                    if (i === quizState.currentQuestion) {
                        questionElement.style.display = 'block';
                        questionElement.classList.add('active');
                    } else {
                        questionElement.style.display = 'none';
                        questionElement.classList.remove('active');
                    }
                }
            }
        }

        function restoreQuizState() {
            // Restore selected answers and their visual states
            Object.keys(quizState.answers).forEach(questionNum => {
                const answer = quizState.answers[questionNum];
                const isCorrect = answer === quizState.correctAnswers[questionNum];
                
                // Restore visual state
                const selectedElement = document.querySelector(`[data-question="${questionNum}"][data-option="${answer}"]`);
                if (selectedElement) {
                    if (isCorrect) {
                        selectedElement.classList.add('border-green-500', 'bg-green-50');
                    } else {
                        selectedElement.classList.add('border-red-500', 'bg-red-50');
                    }
                }
            });
        }

        function resetQuiz() {
            if (confirm('Are you sure you want to reset the quiz? This will clear all your answers.')) {
                quizState.answers = {};
                quizState.currentQuestion = 1;
                saveQuizState();
                
                // Reset all visual states
                document.querySelectorAll('.quiz-option').forEach(option => {
                    option.classList.remove('border-blue-500', 'bg-blue-50', 'border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                    option.classList.add('border-stone-300');
                });
                
                // Hide all explanations
                document.querySelectorAll('[id^="explanation-"]').forEach(exp => {
                    exp.classList.add('hidden');
                });
                
                updateQuizDisplay();
                alert('Quiz has been reset successfully!');
            }
        }

        // Sidebar functions (REQUIRED)
        function toggleSidebar() {
            const content = document.getElementById('sidebar-content');
            const toggle = document.getElementById('sidebar-toggle');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = '‚àí';
            } else {
                content.style.display = 'none';
                toggle.textContent = '+';
            }
        }

        function resetAllProgress() {
            resetProgress();
        }

        function updateSidebarProgress() {
            const completed = Object.values(sectionProgress).filter(Boolean).length;
            const total = Object.keys(sectionProgress).length;
            
            // Update overall progress in sidebar
            const sidebarProgress = document.getElementById('overall-progress-sidebar');
            if (sidebarProgress) {
                sidebarProgress.textContent = `${completed}/${total} Complete`;
            }
            
            // Update section checklist
            const checklist = document.getElementById('section-checklist');
            if (checklist) {
                checklist.innerHTML = `
                    <div class="flex items-center justify-between py-1">
                        <div class="flex items-center">
                            <span class="${sectionProgress['section-1'] ? 'text-blue-600' : 'text-stone-400'}">${sectionProgress['section-1'] ? '‚úì' : '‚óã'}</span>
                            <span class="ml-2 text-sm">What is Bioassay?</span>
                        </div>
                        ${sectionProgress['section-1'] ? '<button onclick="unmarkSection(\'section-1\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                    </div>
                    <div class="flex items-center justify-between py-1">
                        <div class="flex items-center">
                            <span class="${sectionProgress['section-2'] ? 'text-blue-600' : 'text-stone-400'}">${sectionProgress['section-2'] ? '‚úì' : '‚óã'}</span>
                            <span class="ml-2 text-sm">In Vitro vs In Vivo</span>
                        </div>
                        ${sectionProgress['section-2'] ? '<button onclick="unmarkSection(\'section-2\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                    </div>
                    <div class="flex items-center justify-between py-1">
                        <div class="flex items-center">
                            <span class="${sectionProgress['section-3'] ? 'text-blue-600' : 'text-stone-400'}">${sectionProgress['section-3'] ? '‚úì' : '‚óã'}</span>
                            <span class="ml-2 text-sm">Statistical Concepts</span>
                        </div>
                        ${sectionProgress['section-3'] ? '<button onclick="unmarkSection(\'section-3\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                    </div>
                    <div class="flex items-center justify-between py-1">
                        <div class="flex items-center">
                            <span class="${sectionProgress['section-4'] ? 'text-blue-600' : 'text-stone-400'}">${sectionProgress['section-4'] ? '‚úì' : '‚óã'}</span>
                            <span class="ml-2 text-sm">Quality Assurance</span>
                        </div>
                        ${sectionProgress['section-4'] ? '<button onclick="unmarkSection(\'section-4\')" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                    </div>
                    <div class="flex items-center justify-between py-1">
                        <div class="flex items-center">
                            <span class="${sectionProgress['quiz'] ? 'text-blue-600' : 'text-stone-400'}">${sectionProgress['quiz'] ? '‚úì' : '‚óã'}</span>
                            <span class="ml-2 text-sm">Knowledge Check</span>
                        </div>
                        ${sectionProgress['quiz'] ? '<button onclick="resetQuizOnly()" class="text-xs text-red-500 hover:text-red-700">Reset</button>' : ''}
                    </div>
                `;
            }
        }

        // Initialize everything on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
            updateSidebarProgress();
            initializeQuiz(); // Initialize quiz system
            initializeGlossarySystem(); // Initialize glossary modal system
            initializeFeedbackSystem(); // Initialize feedback system
        });

        // Glossary term system now handled by glossary-modal.js
    </script>
</body>
</html>

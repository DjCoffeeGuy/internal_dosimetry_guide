<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 1: Foundations - Internal Dosimetry Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Glossary System -->
    <script src="glossary-definitions.js"></script>
    <script src="glossary-modal.js"></script>
    
    <!-- Feedback System -->
    <script src="feedback-system.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
        }
        
        /* Progress tracking styles */
        .progress-bar {
            background: linear-gradient(to right, #10b981, #06b6d4, #3b82f6, #8b5cf6, #ef4444);
            transition: width 0.3s ease;
        }
        .progress-section {
            transition: all 0.3s ease;
        }
        .progress-section.completed {
            border-left-color: #ea580c;
            background-color: #fff7ed;
        }
        
        /* Progressive Disclosure Styles */
        .foundation-content {
            display: block;
        }
        .deep-dive-content {
            border-left: 3px solid #2563eb;
            padding-left: 12px;
            background-color: #eff6ff;
            border-radius: 6px;
            margin: 8px 0;
        }
        .rabbit-hole-content {
            border-left: 3px solid #7c3aed;
            padding-left: 12px;
            background-color: #f3e8ff;
            border-radius: 6px;
            margin: 8px 0;
        }
        .dive-deeper-btn {
            color: #2563eb;
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: 1px solid #2563eb;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }
        .dive-deeper-btn:hover {
            background-color: #2563eb;
            color: white;
            transform: translateX(2px);
        }
        .rabbit-hole-btn {
            color: #7c3aed;
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: 1px solid #7c3aed;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }
        .rabbit-hole-btn:hover {
            background-color: #7c3aed;
            color: white;
            transform: translateX(2px);
        }
        .glossary-term {
            color: #d97706;
            text-decoration: underline;
            text-decoration-style: dotted;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .glossary-term:hover {
            color: #92400e;
            background-color: #fef3c7;
            padding: 0 2px;
            border-radius: 2px;
        }
        
        /* Quiz styles */
        .quiz-question {
            display: none;
        }
        .quiz-question.active {
            display: block;
        }
        .quiz-option {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .quiz-option:hover {
            background-color: #f3f4f6;
        }
        .quiz-option.selected {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }
        .quiz-option.correct {
            background-color: #dcfce7;
            border-color: #16a34a;
        }
        .quiz-option.incorrect {
            background-color: #fee2e2;
            border-color: #dc2626;
        }
        
        /* Framework styles */
        .framework-box {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .framework-box:hover {
            border-color: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px -4px rgb(0 0 0 / 0.1);
        }

        /* Ensure sidebar layout works */
        .flex.gap-8 {
            display: flex !important;
            gap: 2rem !important;
            align-items: flex-start !important;
        }
        .flex-1 {
            flex: 1 !important;
            min-width: 0 !important;
        }
        .w-80 {
            width: 20rem !important;
            flex-shrink: 0 !important;
        }
    </style>
</head>
<body class="text-stone-800">

    <!-- Progress Tracker -->
    <div class="bg-white border-b border-stone-200 sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <span class="text-sm font-medium text-stone-600">Learning Progress:</span>
                    <div class="w-32 bg-stone-200 rounded-full h-2">
                        <div id="overall-progress" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
                    </div>
                    <span id="progress-text" class="text-sm text-stone-600">0% Complete</span>
                </div>
                <button onclick="resetProgress()" class="text-xs text-red-600 hover:text-red-700 font-medium">
                    Reset Progress
                </button>
            </div>
        </div>
    </div>

    <header class="bg-white shadow-md sticky top-8 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 text-sm text-stone-500">
                        <a href="index.html" class="hover:text-amber-600 font-medium">Learning Hub</a>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                        <span class="text-amber-600 font-medium">Module 1: Foundations</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="openFeedbackAdminDashboard()" class="text-stone-400 hover:text-blue-600 text-sm font-medium" title="Feedback Admin">
                        üõ†Ô∏è Admin
                    </button>
                    <a href="bioassay.html" class="hidden md:inline-flex items-center text-stone-600 hover:text-amber-600 font-medium">
                        Next: Bioassay
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                </div>
            </div>
            <div class="border-t border-stone-200 pt-4">
                <h1 class="text-3xl font-bold text-stone-900 mb-2">Module 1: Foundations of Internal Dosimetry</h1>
                <p class="text-stone-600 mb-4">Master the core concepts and big picture before diving deeper</p>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex gap-8">
            <!-- Main Content -->
            <div class="flex-1">
            
            <!-- Module Introduction -->
            <div class="mb-8 p-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg border-l-4 border-amber-400 bg-white shadow-sm">
                <h2 class="text-2xl font-bold mb-4 text-amber-800">üéØ Module 1 Learning Objectives</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="space-y-2">
                        <h3 class="font-semibold text-amber-800">By the end of this module, you will:</h3>
                        <ul class="text-amber-700 text-sm space-y-1">
                            <li>‚úì Understand what internal dosimetry is and why it matters</li>
                            <li>‚úì Know the three-step process: Measurement ‚Üí Intake ‚Üí Dose</li>
                            <li>‚úì Grasp the overall framework and how models drive everything</li>
                            <li>‚úì Master essential terminology and dose quantities</li>
                        </ul>
                    </div>
                    <div class="bg-white p-4 rounded-lg border border-amber-200">
                        <h3 class="font-bold text-amber-800 mb-2">üîÑ Progressive Discovery</h3>
                        <p class="text-sm text-amber-600">This module uses progressive disclosure - start with foundations, then dive as deep as you want!</p>
                    </div>
                </div>
            </div>

            <!-- Section 1: What is Internal Dosimetry? -->
            <section id="section-1" class="progress-section mb-8 p-6 border-l-4 border-stone-300 bg-stone-50 rounded-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-stone-900">1. What is Internal Dosimetry?</h2>
                    <div class="flex items-center space-x-2">
                        <div id="section-1-status" class="w-6 h-6 rounded-full border-2 border-stone-300 flex items-center justify-center">
                            <span class="text-xs font-bold text-stone-400">1</span>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400 mb-4">
                        <p class="text-blue-800 font-medium">Core Idea: Internal dose is <strong>"inferred,"</strong> not measured. It's the dose from <span class="glossary-term" data-term="radionuclides">radionuclides</span> inside the body.</p>
                    </div>
                    <p class="text-lg mb-4">Unlike external radiation from outside sources, <span class="glossary-term" data-term="internal-dosimetry">internal dosimetry</span> deals with radioactive material that has entered the body through inhalation, ingestion, or absorption through the skin.</p>
                    
                    <div class="bg-amber-50 p-4 rounded-lg border border-amber-200 mb-4">
                        <h3 class="font-bold text-amber-800 mb-2">üí° Key Insight</h3>
                        <p class="text-amber-700">We can't directly measure dose inside the body - we have to <em>infer</em> it from measurements we can make (bioassay) using mathematical models.</p>
                    </div>
                </div>

                <button class="dive-deeper-btn mb-4" onclick="toggleDeepDive('why-inferred')">
                    ‚ñº Dive Deeper: Why is Internal Dose "Inferred"?
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>

                <div id="why-inferred" class="deep-dive-content hidden mb-4">
                    <h4 class="font-semibold mb-3">Why Can't We Measure Internal Dose Directly?</h4>
                    <div class="space-y-3">
                        <div class="bg-white p-3 rounded border border-blue-300">
                            <h5 class="font-semibold text-blue-800">Physical Limitations</h5>
                            <p class="text-blue-700 text-sm">Dosimeters can't be placed inside organs. Alpha and beta radiation have limited range - they deposit energy locally but can't be detected outside the body.</p>
                        </div>
                        <div class="bg-white p-3 rounded border border-blue-300">
                            <h5 class="font-semibold text-blue-800">Biological Complexity</h5>
                            <p class="text-blue-700 text-sm">Radioactive material moves, concentrates in different organs, and is eliminated over time. The dose pattern is dynamic and organ-specific.</p>
                        </div>
                        <div class="bg-white p-3 rounded border border-blue-300">
                            <h5 class="font-semibold text-blue-800">Time Integration</h5>
                            <p class="text-blue-700 text-sm">Internal dose accumulates over 50 years. We need to predict future dose from current measurements.</p>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <div class="flex items-center space-x-3">
                        <button id="section-1-complete-btn" onclick="markSectionComplete('section-1')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                            Mark Section Complete
                        </button>
                    </div>
                    <button id="section-1-reset-btn" onclick="unmarkSection('section-1')" class="hidden mt-2 text-stone-500 hover:text-red-600 text-sm px-3 py-1 border border-stone-300 rounded hover:border-red-300 transition-colors">
                        Reset Section
                    </button>
                </div>
            </section>

            <!-- Section 2: The Three-Step Process -->
            <section id="section-2" class="progress-section mb-8 p-6 border-l-4 border-stone-300 bg-stone-50 rounded-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-stone-900">2. The Three-Step Process</h2>
                    <div class="flex items-center space-x-2">
                        <div id="section-2-status" class="w-6 h-6 rounded-full border-2 border-stone-300 flex items-center justify-center">
                            <span class="text-xs font-bold text-stone-400">2</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 text-center">
                        <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mx-auto mb-3">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <h4 class="font-bold text-green-800 mb-2">1. Obtain Measurement</h4>
                        <p class="text-green-700 text-sm">Detect and quantify radioactive material using <span class="glossary-term" data-term="radiobioassay">bioassay</span> techniques</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 text-center">
                        <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mx-auto mb-3">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <h4 class="font-bold text-blue-800 mb-2">2. Determine Intake</h4>
                        <p class="text-blue-700 text-sm">Use <span class="glossary-term" data-term="biokinetic-models">biokinetic models</span> to calculate <span class="glossary-term" data-term="intake">intake</span> from measurements</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-200 text-center">
                        <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center mx-auto mb-3">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <h4 class="font-bold text-purple-800 mb-2">3. Infer Dose</h4>
                        <p class="text-purple-700 text-sm">Convert intake to <span class="glossary-term" data-term="committed-effective-dose">committed effective dose</span> using <span class="glossary-term" data-term="dose-coefficients">dose coefficients</span></p>
                    </div>
                </div>

                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200 mb-4">
                    <h4 class="font-semibold text-purple-800 mb-2">üí° Critical Insight</h4>
                    <p class="text-purple-700 text-sm">Each step depends on <strong>biokinetic models</strong> - they're the mathematical foundation that makes internal dosimetry possible!</p>
                </div>

                <div class="mt-6">
                    <div class="flex items-center space-x-3">
                        <button id="section-2-complete-btn" onclick="markSectionComplete('section-2')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                            Mark Section Complete
                        </button>
                        </button>
                        </button>
                        </button>
                    </div>
                    <button id="section-2-reset-btn" onclick="unmarkSection('section-2')" class="hidden mt-2 text-stone-500 hover:text-red-600 text-sm px-3 py-1 border border-stone-300 rounded hover:border-red-300 transition-colors">
                        Reset Section
                    </button>
                </div>
            </section>

            <!-- Section 3: The Overall Framework -->
            <section id="section-3" class="progress-section mb-8 p-6 border-l-4 border-stone-300 bg-stone-50 rounded-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-stone-900">3. The Overall Framework</h2>
                    <div class="flex items-center space-x-2">
                        <div id="section-3-status" class="w-6 h-6 rounded-full border-2 border-stone-300 flex items-center justify-center">
                            <span class="text-xs font-bold text-stone-400">3</span>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mb-6">
                    <div class="bg-stone-50 p-6 rounded-lg border border-stone-200 w-full max-w-5xl">
                        <svg viewBox="0 0 1000 500" class="w-full h-auto" style="min-height: 400px;">
                            <!-- Defs for arrowheads -->
                            <defs>
                                <marker id="arrowhead" markerWidth="12" markerHeight="10" refX="11" refY="5" orient="auto" markerUnits="strokeWidth">
                                    <polygon points="0 0, 12 5, 0 10" fill="#78716c" stroke="#78716c"/>
                                </marker>
                                
                                <!-- Gradient definitions for themed colors -->
                                <linearGradient id="modelsGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#fef3c7;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="dataGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#dbeafe;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="intakeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#dcfce7;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="doseCoeffGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#fed7aa;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="doseGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#e9d5ff;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="standardGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#fecaca;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            
                            <!-- Top row: Models and Data -->
                            <!-- Models box -->
                            <rect x="80" y="60" width="180" height="100" fill="url(#modelsGradient)" stroke="#d97706" stroke-width="3" rx="8" class="framework-box" style="cursor: pointer;" onclick="showFrameworkPopup('models')"/>
                            <text x="170" y="100" text-anchor="middle" font-size="20" font-weight="bold" fill="#92400e" style="pointer-events: none;">Models</text>
                            <text x="170" y="125" text-anchor="middle" font-size="14" fill="#b45309" style="pointer-events: none;">Biokinetic</text>
                            
                            <!-- Data box -->
                            <rect x="740" y="60" width="180" height="100" fill="url(#dataGradient)" stroke="#2563eb" stroke-width="3" rx="8" class="framework-box" style="cursor: pointer;" onclick="showFrameworkPopup('data')"/>
                            <text x="830" y="95" text-anchor="middle" font-size="20" font-weight="bold" fill="#1e40af" style="pointer-events: none;">Data</text>
                            <text x="830" y="115" text-anchor="middle" font-size="14" fill="#1d4ed8" style="pointer-events: none;">(Bioassay)</text>
                            <text x="830" y="135" text-anchor="middle" font-size="14" fill="#1d4ed8" style="pointer-events: none;">Measurements</text>
                            
                            <!-- Arrows from Models and Data to Intake -->
                            <!-- Left arrow: Models to Intake -->
                            <path d="M 170 160 L 170 200 L 420 200 L 420 230" stroke="#78716c" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                            
                            <!-- Right arrow: Data to Intake -->
                            <path d="M 830 160 L 830 200 L 580 200 L 580 230" stroke="#78716c" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                            
                            <!-- Middle: Intake box -->
                            <rect x="420" y="230" width="160" height="80" fill="url(#intakeGradient)" stroke="#16a34a" stroke-width="3" rx="8" class="framework-box" style="cursor: pointer;" onclick="showFrameworkPopup('intake')"/>
                            <text x="500" y="275" text-anchor="middle" font-size="22" font-weight="bold" fill="#15803d" style="pointer-events: none;">Intake</text>
                            <text x="500" y="295" text-anchor="middle" font-size="14" fill="#166534" style="pointer-events: none;">Estimation</text>
                            
                            <!-- Bottom row -->
                            <!-- Dose Coefficient box -->
                            <rect x="80" y="380" width="180" height="100" fill="url(#doseCoeffGradient)" stroke="#ea580c" stroke-width="3" rx="8" class="framework-box" style="cursor: pointer;" onclick="showFrameworkPopup('dosecoeff')"/>
                            <text x="170" y="415" text-anchor="middle" font-size="18" font-weight="bold" fill="#c2410c" style="pointer-events: none;">Dose</text>
                            <text x="170" y="435" text-anchor="middle" font-size="18" font-weight="bold" fill="#c2410c" style="pointer-events: none;">Coefficient</text>
                            <text x="170" y="455" text-anchor="middle" font-size="14" fill="#9a3412" style="pointer-events: none;">Sv/Bq</text>
                            
                            <!-- Dose box -->
                            <rect x="420" y="380" width="160" height="100" fill="url(#doseGradient)" stroke="#9333ea" stroke-width="3" rx="8" class="framework-box" style="cursor: pointer;" onclick="showFrameworkPopup('dose')"/>
                            <text x="500" y="425" text-anchor="middle" font-size="22" font-weight="bold" fill="#7c3aed" style="pointer-events: none;">Dose</text>
                            <text x="500" y="445" text-anchor="middle" font-size="14" fill="#6d28d9" style="pointer-events: none;">Committed</text>
                            <text x="500" y="460" text-anchor="middle" font-size="14" fill="#6d28d9" style="pointer-events: none;">Effective</text>
                            
                            <!-- Standard box -->
                            <rect x="740" y="380" width="180" height="100" fill="url(#standardGradient)" stroke="#dc2626" stroke-width="3" rx="8" class="framework-box" style="cursor: pointer;" onclick="showFrameworkPopup('standard')"/>
                            <text x="830" y="420" text-anchor="middle" font-size="20" font-weight="bold" fill="#b91c1c" style="pointer-events: none;">Standard</text>
                            <text x="830" y="440" text-anchor="middle" font-size="14" fill="#991b1b" style="pointer-events: none;">Regulatory</text>
                            <text x="830" y="455" text-anchor="middle" font-size="14" fill="#991b1b" style="pointer-events: none;">Compliance</text>
                            
                            <!-- Arrows for bottom connections -->
                            <!-- Models down to Dose Coefficient -->
                            <path d="M 170 160 L 170 380" stroke="#78716c" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                            
                            <!-- Intake down to Dose -->
                            <path d="M 500 310 L 500 380" stroke="#78716c" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                            
                            <!-- Dose Coefficient to Dose -->
                            <path d="M 260 430 L 420 430" stroke="#78716c" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                            
                            <!-- Dose to Standard -->
                            <path d="M 580 430 L 740 430" stroke="#78716c" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
                        </svg>
                    </div>
                </div>
                
                <!-- Under the flowchart: key equation -->
                <div class="flex justify-center mb-6">
                    <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-6 rounded-lg border border-amber-300 shadow-sm">
                        <p class="text-center text-amber-800 font-mono text-xl font-bold">
                            <span class="text-orange-700">Dose Coefficient</span> √ó <span class="text-green-700">Intake</span> = <span class="text-purple-700">Dose</span>
                        </p>
                        <p class="text-center text-amber-600 text-sm mt-3">The fundamental equation of internal dosimetry</p>
                    </div>
                </div>

                <div class="mt-6">
                    <button id="section-3-complete-btn" onclick="markSectionComplete('section-3')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                        Mark Section Complete
                    </button>
                    <button id="section-3-reset-btn" onclick="unmarkSection('section-3')" class="hidden ml-2 text-stone-500 hover:text-red-600 text-sm px-3 py-1 border border-stone-300 rounded hover:border-red-300 transition-colors">
                        Reset Section
                    </button>
                </div>
            </section>

            <!-- Section 4: Essential Terminology -->
            <section id="section-4" class="progress-section mb-8 p-6 border-l-4 border-stone-300 bg-stone-50 rounded-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-stone-900">4. Essential Terminology</h2>
                    <div class="flex items-center space-x-2">
                        <div id="section-4-status" class="w-6 h-6 rounded-full border-2 border-stone-300 flex items-center justify-center">
                            <span class="text-xs font-bold text-stone-400">4</span>
                        </div>
                    </div>
                </div>

                <!-- Dose Quantities -->
                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-3">Dose Quantities: What Each One Accounts For</h3>
                    <div class="space-y-4">
                        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                            <h4 class="font-bold text-yellow-800 mb-2"><span class="glossary-term" data-term="absorbed-dose">Absorbed Dose (Gy)</span></h4>
                            <p class="text-yellow-700 text-sm">Accounts for: <strong>Physical energy</strong> deposited per unit mass</p>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <h4 class="font-bold text-orange-800 mb-2"><span class="glossary-term" data-term="equivalent-dose">Equivalent Dose (Sv)</span></h4>
                            <p class="text-orange-700 text-sm">Accounts for: <strong>Radiation type</strong> (alpha, beta, gamma) biological effectiveness</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                            <h4 class="font-bold text-red-800 mb-2"><span class="glossary-term" data-term="effective-dose">Effective Dose (Sv)</span></h4>
                            <p class="text-red-700 text-sm">Accounts for: <strong>Tissue sensitivity</strong> - different organs have different cancer risks</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <h4 class="font-bold text-purple-800 mb-2"><span class="glossary-term" data-term="committed-effective-dose">Committed Effective Dose (Sv)</span></h4>
                            <p class="text-purple-700 text-sm">Accounts for: <strong>Time</strong> - dose received over 50 years from internal contamination</p>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <button id="section-4-complete-btn" onclick="markSectionComplete('section-4')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                        Mark Section Complete
                    </button>
                    <button id="section-4-reset-btn" onclick="unmarkSection('section-4')" class="hidden ml-2 text-stone-500 hover:text-red-600 text-sm px-3 py-1 border border-stone-300 rounded hover:border-red-300 transition-colors">
                        Reset Section
                    </button>
                </div>
            </section>

            <!-- Knowledge Check Quiz -->
            <section id="knowledge-check" class="mb-8 p-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg border border-amber-200">
                <h2 class="text-2xl font-bold mb-4 text-amber-800">üìù Knowledge Check</h2>
                <p class="text-amber-700 mb-6">Test your understanding of the foundations before moving to the next module!</p>
                
                <div id="quiz-container">
                    <!-- Quiz Question 1 -->
                    <div id="question-1" class="quiz-question active">
                        <h3 class="text-lg font-semibold mb-4 text-stone-800">Question 1 of 3</h3>
                        <p class="text-stone-700 mb-4">Why is internal dose "inferred" rather than directly measured?</p>
                        <div class="space-y-2">
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="1" data-option="A">
                                <span class="font-semibold">A)</span> Because alpha and beta radiation have limited range and organs are inaccessible for direct measurement
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="1" data-option="B">
                                <span class="font-semibold">B)</span> Because radiation detectors are too expensive to place inside the body
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="1" data-option="C">
                                <span class="font-semibold">C)</span> Because internal radiation levels are too low to detect
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="1" data-option="D">
                                <span class="font-semibold">D)</span> Because regulations prohibit internal measurement devices
                            </div>
                        </div>
                        <div id="explanation-1" class="hidden mt-4 p-3 bg-green-50 border border-green-200 rounded">
                            <p class="text-green-800 text-sm"><strong>Correct!</strong> Alpha and beta radiation deposit energy locally with limited range. We can't place dosimeters inside organs, and the dose accumulates over 50 years, requiring mathematical models to predict future dose patterns.</p>
                        </div>
                    </div>

                    <!-- Quiz Question 2 -->
                    <div id="question-2" class="quiz-question">
                        <h3 class="text-lg font-semibold mb-4 text-stone-800">Question 2 of 3</h3>
                        <p class="text-stone-700 mb-4">In the three-step internal dosimetry process, what mathematical tool connects bioassay measurements to intake estimates?</p>
                        <div class="space-y-2">
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="2" data-option="A">
                                <span class="font-semibold">A)</span> Dose coefficients
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="2" data-option="B">
                                <span class="font-semibold">B)</span> Intake Retention Functions (IRFs) from biokinetic models
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="2" data-option="C">
                                <span class="font-semibold">C)</span> Statistical detection limits
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="2" data-option="D">
                                <span class="font-semibold">D)</span> Tissue weighting factors
                            </div>
                        </div>
                        <div id="explanation-2" class="hidden mt-4 p-3 bg-green-50 border border-green-200 rounded">
                            <p class="text-green-800 text-sm"><strong>Correct!</strong> IRFs predict what the bioassay measurement should be at different times after intake. The equation is: Intake = Measurement √∑ IRF(t). Dose coefficients are used in Step 3 to convert intake to dose.</p>
                        </div>
                    </div>

                    <!-- Quiz Question 3 -->
                    <div id="question-3" class="quiz-question">
                        <h3 class="text-lg font-semibold mb-4 text-stone-800">Question 3 of 3</h3>
                        <p class="text-stone-700 mb-4">Which dose quantity accounts for BOTH radiation type effectiveness AND tissue sensitivity differences?</p>
                        <div class="space-y-2">
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="3" data-option="A">
                                <span class="font-semibold">A)</span> Absorbed dose (Gy)
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="3" data-option="B">
                                <span class="font-semibold">B)</span> Equivalent dose (Sv)
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="3" data-option="C">
                                <span class="font-semibold">C)</span> Effective dose (Sv)
                            </div>
                            <div class="quiz-option p-3 border border-stone-300 rounded cursor-pointer" data-question="3" data-option="D">
                                <span class="font-semibold">D)</span> Activity (Bq)
                            </div>
                        </div>
                        <div id="explanation-3" class="hidden mt-4 p-3 bg-green-50 border border-green-200 rounded">
                            <p class="text-green-800 text-sm"><strong>Correct!</strong> Effective dose includes both radiation weighting factors (for radiation type) and tissue weighting factors (for tissue sensitivity). Equivalent dose only accounts for radiation type, and absorbed dose is the raw energy deposition.</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between items-center mt-6">
                    <div class="flex space-x-2">
                        <button id="prev-question" class="px-4 py-2 bg-stone-500 text-white rounded hover:bg-stone-600 transition-colors disabled:opacity-50" disabled>
                            Previous
                        </button>
                        <button onclick="resetQuiz()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors text-sm">
                            Reset Quiz
                        </button>
                    </div>
                    <div class="flex space-x-2">
                        <span id="question-indicator" class="px-3 py-1 bg-amber-100 text-amber-800 rounded text-sm">Question 1 of 3</span>
                    </div>
                    <button id="next-question" class="px-4 py-2 bg-amber-500 text-white rounded hover:bg-amber-600 transition-colors">
                        Next Question
                    </button>
                </div>

                <div id="quiz-complete" class="hidden mt-6 p-4 bg-amber-50 border border-amber-200 rounded">
                    <h3 class="text-lg font-semibold text-amber-800 mb-2">‚úÖ Module 1 Complete!</h3>
                    <p class="text-amber-700 mb-4">Excellent work! You've mastered the foundational concepts. You're ready to learn about bioassay measurement techniques.</p>
                    <a href="bioassay.html" class="inline-block bg-amber-600 text-white px-6 py-2 rounded hover:bg-amber-700 transition-colors">
                        Continue to Module 2: Bioassay ‚Üí
                    </a>
                </div>
            </section>

            <!-- Module Summary -->
            <div class="bg-amber-50 p-6 rounded-lg border border-amber-200">
                <h2 class="text-xl font-bold text-amber-800 mb-3">üìñ Module 1 Summary</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <h3 class="font-semibold text-amber-800 mb-2">Key Concepts Mastered:</h3>
                        <ul class="text-amber-700 space-y-1">
                            <li>‚Ä¢ Internal dose is inferred, not measured</li>
                            <li>‚Ä¢ Three-step process: Measurement ‚Üí Intake ‚Üí Dose</li>
                            <li>‚Ä¢ Biokinetic models drive everything</li>
                            <li>‚Ä¢ Dose quantities build in complexity</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-semibold text-amber-800 mb-2">Ready for Next Module:</h3>
                        <p class="text-amber-700">You now understand the big picture. Next, we'll dive deep into Step 1: how to obtain reliable bioassay measurements and interpret them statistically.</p>
                    </div>
                </div>
            </div>
            
            <!-- Progress Tracking Sidebar -->
            <div class="w-80">
                <div id="progress-sidebar" class="bg-white rounded-lg shadow-sm border border-stone-200 p-4 sticky top-4">
                    <button onclick="toggleSidebar()" class="w-full flex items-center justify-between text-left font-semibold text-stone-700 mb-4">
                        <span>üìä Progress Tracker</span>
                        <span id="sidebar-toggle">‚àí</span>
                    </button>
                    
                    <div id="sidebar-content">
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-stone-600">Overall Progress:</span>
                                <span id="overall-progress-sidebar" class="text-sm font-semibold text-blue-600">0/4 Complete</span>
                            </div>
                            
                            <div class="space-y-2" id="section-checklist">
                                <!-- Dynamic content populated by updateSidebarProgress() -->
                            </div>
                            
                            <div class="pt-3 border-t border-stone-200">
                                <button onclick="resetAllProgress()" class="w-full px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition-colors">
                                    Reset All Progress
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Framework Modal -->
    <div id="frameworkModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-xl font-bold text-stone-800"></h3>
                <button onclick="closeFrameworkPopup()" class="text-stone-400 hover:text-stone-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="modalContent" class="text-stone-600">
                <!-- Content populated by JavaScript -->
            </div>
            <div class="mt-6 flex justify-end">
                <button onclick="closeFrameworkPopup()" class="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700 transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Progress tracking system
        let sectionProgress = {
            'section-1': false,
            'section-2': false,
            'section-3': false,
            'section-4': false
        };

        // Load progress from localStorage
        function loadProgress() {
            const saved = localStorage.getItem('foundations-progress');
            if (saved) {
                sectionProgress = { ...sectionProgress, ...JSON.parse(saved) };
                updateProgressDisplay();
                updateSectionVisuals();
                updateSidebarProgress();
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            localStorage.setItem('foundations-progress', JSON.stringify(sectionProgress));
        }

        // Mark section complete
        function markSectionComplete(sectionId) {
            sectionProgress[sectionId] = true;
            saveProgress();
            updateProgressDisplay();
            updateSectionVisuals();
            updateSidebarProgress();
            
            // Visual feedback
            const section = document.getElementById(sectionId);
            section.classList.add('completed');
            
            // Animate status indicator
            const status = document.getElementById(sectionId + '-status');
            status.innerHTML = '<svg class="w-4 h-4 text-amber-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>';
            status.style.backgroundColor = '#d97706';
            status.style.borderColor = '#d97706';
            
            // Update button states
            const completeBtn = document.getElementById(sectionId + '-complete-btn');
            const resetBtn = document.getElementById(sectionId + '-reset-btn');
            
            if (completeBtn) {
                completeBtn.classList.add('bg-stone-400', 'cursor-not-allowed');
                completeBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                completeBtn.disabled = true;
                completeBtn.innerHTML = '‚úì Section Complete';
            }
            
            if (resetBtn) {
                resetBtn.classList.remove('hidden');
            }
        }

        // Unmark section (reset)
        function unmarkSection(sectionId) {
            sectionProgress[sectionId] = false;
            saveProgress();
            updateProgressDisplay();
            updateSectionVisuals();
            updateSidebarProgress();
            
            // Reset visual state
            const section = document.getElementById(sectionId);
            section.classList.remove('completed');
            
            // Reset status indicator
            const status = document.getElementById(sectionId + '-status');
            const sectionNumber = sectionId.split('-')[1];
            status.innerHTML = `<span class="text-xs font-bold text-stone-400">${sectionNumber}</span>`;
            status.style.backgroundColor = '';
            status.style.borderColor = '#d1d5db';
            
            // Reset button states
            const completeBtn = document.getElementById(sectionId + '-complete-btn');
            const resetBtn = document.getElementById(sectionId + '-reset-btn');
            
            if (completeBtn) {
                completeBtn.classList.remove('bg-stone-400', 'cursor-not-allowed');
                completeBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                completeBtn.disabled = false;
                completeBtn.innerHTML = 'Mark Section Complete';
            }
            
            if (resetBtn) {
                resetBtn.classList.add('hidden');
            }
        }

        // Reset all progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress for this module? This cannot be undone.')) {
                // Reset progress object
                Object.keys(sectionProgress).forEach(key => {
                    sectionProgress[key] = false;
                });
                
                // Clear localStorage
                localStorage.removeItem('foundations-progress');
                localStorage.removeItem('foundations-quiz');
                
                // Update UI
                updateProgressDisplay();
                updateSectionVisuals();
                updateSidebarProgress();
                
                // Reset quiz if needed
                resetQuiz();
            }
        }

        // Sidebar functions
        function toggleSidebar() {
            const content = document.getElementById('sidebar-content');
            const toggle = document.getElementById('sidebar-toggle');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = '‚àí';
            } else {
                content.style.display = 'none';
                toggle.textContent = '+';
            }
        }

        function resetAllProgress() {
            resetProgress();
        }

        function updateSidebarProgress() {
            const completed = Object.values(sectionProgress).filter(Boolean).length;
            const total = Object.keys(sectionProgress).length;
            
            // Update overall progress in sidebar
            const sidebarProgress = document.getElementById('overall-progress-sidebar');
            if (sidebarProgress) {
                sidebarProgress.textContent = `${completed}/${total} Complete`;
            }
            
            // Update section checklist
            const checklist = document.getElementById('section-checklist');
            if (checklist) {
                const sections = [
                    { id: 'section-1', name: '1. What is Internal Dosimetry?' },
                    { id: 'section-2', name: '2. Three-Step Process' },
                    { id: 'section-3', name: '3. Overall Framework' },
                    { id: 'section-4', name: '4. Essential Terminology' }
                ];
                
                let html = '';
                sections.forEach(section => {
                    const isComplete = sectionProgress[section.id];
                    const checkmark = isComplete ? '‚úì' : '‚óã';
                    const checkColor = isComplete ? 'text-green-600' : 'text-stone-400';
                    const resetButton = isComplete ? `<button onclick="unmarkSection('${section.id}')" class="text-xs text-red-500 hover:text-red-700">Reset</button>` : '';
                    
                    html += `
                        <div class="flex items-center justify-between py-1">
                            <div class="flex items-center">
                                <span class="${checkColor}">${checkmark}</span>
                                <span class="ml-2 text-sm">${section.name}</span>
                            </div>
                            ${resetButton}
                        </div>
                    `;
                });
                
                checklist.innerHTML = html;
            }
        }

        // Update progress display
        function updateProgressDisplay() {
            const completed = Object.values(sectionProgress).filter(Boolean).length;
            const total = Object.keys(sectionProgress).length;
            const percentage = Math.round((completed / total) * 100);
            
            // Update progress bar  
            document.getElementById('overall-progress').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = percentage + '% Complete';
            
            // CRITICAL: Always update sidebar
            updateSidebarProgress();
        }

        // Update section visuals
        function updateSectionVisuals() {
            // Update section status indicators
            Object.keys(sectionProgress).forEach(sectionId => {
                const section = document.getElementById(sectionId);
                const status = document.getElementById(sectionId + '-status');
                const completeBtn = document.getElementById(sectionId + '-complete-btn');
                const resetBtn = document.getElementById(sectionId + '-reset-btn');
                
                if (sectionProgress[sectionId]) {
                    if (section) section.classList.add('completed');
                    if (status) {
                        status.innerHTML = '<svg class="w-4 h-4 text-amber-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>';
                        status.style.backgroundColor = '#d97706';
                        status.style.borderColor = '#d97706';
                    }
                    if (completeBtn) {
                        completeBtn.classList.add('bg-stone-400', 'cursor-not-allowed');
                        completeBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                        completeBtn.disabled = true;
                        completeBtn.innerHTML = '‚úì Section Complete';
                    }
                    if (resetBtn) {
                        resetBtn.classList.remove('hidden');
                    }
                } else {
                    if (section) section.classList.remove('completed');
                    if (status) {
                        const sectionNumber = sectionId.split('-')[1];
                        status.innerHTML = `<span class="text-xs font-bold text-stone-400">${sectionNumber}</span>`;
                        status.style.backgroundColor = '';
                        status.style.borderColor = '#d1d5db';
                    }
                    if (completeBtn) {
                        completeBtn.classList.remove('bg-stone-400', 'cursor-not-allowed');
                        completeBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                        completeBtn.disabled = false;
                        completeBtn.innerHTML = 'Mark Section Complete';
                    }
                    if (resetBtn) {
                        resetBtn.classList.add('hidden');
                    }
                }
            });
        }

        // Toggle collapsible content
        function toggleCollapse(id) {
            const content = document.getElementById(id);
            const button = event.target.closest('.collapse-btn');
            const arrow = button.querySelector('span:last-child');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                arrow.textContent = '‚ñ≤';
            } else {
                content.classList.add('hidden');
                arrow.textContent = '‚ñº';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
            updateSidebarProgress(); // CRITICAL: Initialize sidebar
            updateProgressDisplay();
            updateSectionVisuals();
            initializeQuiz();
            initializeGlossarySystem(); // Initialize glossary modal system
            initializeFeedbackSystem(); // Initialize feedback system
        });

        // Quiz system with persistence
        let quizState = {
            currentQuestion: 1,
            totalQuestions: 3,
            answers: {},
            correctAnswers: { 1: 'A', 2: 'B', 3: 'C' }
        };

        function initializeQuiz() {
            loadQuizState();
            setupQuizEventListeners();
            updateQuizDisplay();
            restoreQuizState();
        }

        function loadQuizState() {
            const saved = localStorage.getItem('foundations-quiz');
            if (saved) {
                const savedState = JSON.parse(saved);
                quizState = { ...quizState, ...savedState };
            }
        }

        function saveQuizState() {
            localStorage.setItem('foundations-quiz', JSON.stringify(quizState));
        }

        function setupQuizEventListeners() {
            // Add click handlers to quiz options
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function() {
                    const question = parseInt(this.getAttribute('data-question'));
                    const selectedOption = this.getAttribute('data-option');
                    selectQuizOption(question, selectedOption);
                });
            });

            // Add handlers to navigation buttons
            const prevBtn = document.getElementById('prev-question');
            const nextBtn = document.getElementById('next-question');
            
            if (prevBtn) prevBtn.addEventListener('click', previousQuestion);
            if (nextBtn) nextBtn.addEventListener('click', nextQuestion);
        }

        function selectQuizOption(questionNum, option) {
            // Store the answer
            quizState.answers[questionNum] = option;
            saveQuizState();
            
            // Remove previous selections for this question
            document.querySelectorAll(`[data-question="${questionNum}"]`).forEach(opt => {
                opt.classList.remove('border-blue-500', 'bg-blue-50', 'border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                opt.classList.add('border-stone-300');
            });
            
            // Highlight selected option
            const selectedElement = document.querySelector(`[data-question="${questionNum}"][data-option="${option}"]`);
            const isCorrect = option === quizState.correctAnswers[questionNum];
            
            if (isCorrect) {
                selectedElement.classList.remove('border-stone-300');
                selectedElement.classList.add('border-green-500', 'bg-green-50');
            } else {
                selectedElement.classList.remove('border-stone-300');
                selectedElement.classList.add('border-red-500', 'bg-red-50');
            }
            
            // Show explanation
            showQuizExplanation(questionNum, isCorrect);
        }

        function showQuizExplanation(questionNum, isCorrect) {
            const explanation = document.getElementById(`explanation-${questionNum}`);
            if (!explanation) return;
            
            explanation.classList.remove('hidden');
            
            if (isCorrect) {
                explanation.classList.remove('bg-red-50', 'border-red-200');
                explanation.classList.add('bg-green-50', 'border-green-200');
                const p = explanation.querySelector('p');
                if (p) p.className = 'text-green-800 text-sm';
            } else {
                explanation.classList.remove('bg-green-50', 'border-green-200');
                explanation.classList.add('bg-red-50', 'border-red-200');
                
                const correctAnswer = quizState.correctAnswers[questionNum];
                explanation.innerHTML = `
                    <p class="text-red-800 text-sm">
                        <strong>Incorrect.</strong> The correct answer is <strong>${correctAnswer}</strong>. 
                        ${getCorrectExplanation(questionNum)}
                    </p>
                `;
            }
        }

        function getCorrectExplanation(questionNum) {
            const explanations = {
                1: "Alpha and beta radiation deposit energy locally with limited range. We can't place dosimeters inside organs, and the dose accumulates over 50 years, requiring mathematical models to predict future dose patterns.",
                2: "IRFs predict what the bioassay measurement should be at different times after intake. The equation is: Intake = Measurement √∑ IRF(t). Dose coefficients are used in Step 3 to convert intake to dose.",
                3: "Effective dose includes both radiation weighting factors (for radiation type) and tissue weighting factors (for tissue sensitivity). Equivalent dose only accounts for radiation type, and absorbed dose is the raw energy deposition."
            };
            return explanations[questionNum] || "Review the material for the correct answer.";
        }

        function restoreQuizState() {
            // Restore selected answers
            Object.keys(quizState.answers).forEach(questionNum => {
                const option = quizState.answers[questionNum];
                if (option) {
                    selectQuizOption(parseInt(questionNum), option);
                }
            });
        }

        function nextQuestion() {
            if (quizState.currentQuestion < quizState.totalQuestions) {
                quizState.currentQuestion++;
                saveQuizState();
                updateQuizDisplay();
            } else {
                finishQuiz();
            }
        }

        function previousQuestion() {
            if (quizState.currentQuestion > 1) {
                quizState.currentQuestion--;
                saveQuizState();
                updateQuizDisplay();
            }
        }

        function updateQuizDisplay() {
            // Hide all explanations when changing questions
            document.querySelectorAll('[id^="explanation-"]').forEach(exp => {
                exp.classList.add('hidden');
            });
            
            // Update question indicator
            const indicator = document.getElementById('question-indicator');
            if (indicator) {
                indicator.textContent = `Question ${quizState.currentQuestion} of ${quizState.totalQuestions}`;
            }
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prev-question');
            const nextBtn = document.getElementById('next-question');
            
            if (prevBtn) {
                prevBtn.disabled = quizState.currentQuestion === 1;
            }
            
            if (nextBtn) {
                if (quizState.currentQuestion === quizState.totalQuestions) {
                    nextBtn.textContent = 'Finish Quiz';
                } else {
                    nextBtn.textContent = 'Next Question';
                }
            }
            
            // Show/hide questions
            for (let i = 1; i <= quizState.totalQuestions; i++) {
                const questionElement = document.getElementById(`question-${i}`);
                if (questionElement) {
                    if (i === quizState.currentQuestion) {
                        questionElement.style.display = 'block';
                        questionElement.classList.add('active');
                    } else {
                        questionElement.style.display = 'none';
                        questionElement.classList.remove('active');
                    }
                }
            }
        }

        function resetQuiz() {
            if (confirm('Are you sure you want to reset the quiz? This will clear all your answers.')) {
                quizState.answers = {};
                quizState.currentQuestion = 1;
                saveQuizState();
                
                // Reset all visual states
                document.querySelectorAll('.quiz-option').forEach(option => {
                    option.classList.remove('border-blue-500', 'bg-blue-50', 'border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
                    option.classList.add('border-stone-300');
                });
                
                // Hide all explanations
                document.querySelectorAll('[id^="explanation-"]').forEach(exp => {
                    exp.classList.add('hidden');
                });
                
                updateQuizDisplay();
                alert('Quiz has been reset successfully!');
            }
        }

        function finishQuiz() {
            const totalAnswered = Object.keys(quizState.answers).length;
            const correctCount = Object.keys(quizState.answers).filter(q => 
                quizState.answers[q] === quizState.correctAnswers[parseInt(q)]
            ).length;
            
            const score = totalAnswered > 0 ? Math.round((correctCount / quizState.totalQuestions) * 100) : 0;
            
            let message = `Quiz Complete!\n\nScore: ${correctCount}/${quizState.totalQuestions} (${score}%)\nAnswered: ${totalAnswered}/${quizState.totalQuestions} questions`;
            
            if (score >= 75) {
                message += "\n\nüéâ Excellent work! You've demonstrated strong understanding of internal dosimetry foundations.";
            } else if (score >= 50) {
                message += "\n\nüëç Good effort! Review the explanations and consider retaking the quiz to improve your score.";
            } else {
                message += "\n\nüìö Keep studying! Review the module content and explanations, then try again.";
            }
            
            alert(message);
        }

        // Toggle deep dive content
        function toggleDeepDive(id) {
            const content = document.getElementById(id);
            const button = event.target;
            const arrow = button.querySelector('svg');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                if (arrow) arrow.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                if (arrow) arrow.style.transform = 'rotate(0deg)';
            }
        }

        // Framework popup functionality
        function showFrameworkPopup(type) {
            const popups = {
                'models': {
                    title: 'Biokinetic Models',
                    content: 'Mathematical models that describe how radioactive materials move through and are eliminated from the body. They predict bioassay measurements and calculate dose distributions.'
                },
                'data': {
                    title: 'Bioassay Data',
                    content: 'Measurements of radioactive material in biological samples (urine, feces) or directly in the body (whole body counting). This is our only direct evidence of internal contamination.'
                },
                'intake': {
                    title: 'Intake Estimation',
                    content: 'The process of working backwards from bioassay measurements to estimate how much radioactive material originally entered the body, using Intake Retention Functions (IRFs).'
                },
                'dosecoeff': {
                    title: 'Dose Coefficients',
                    content: 'Pre-calculated values (Sv/Bq) that convert intake to committed effective dose. They incorporate all the complex physics and biology of dose delivery over 50 years.'
                },
                'dose': {
                    title: 'Committed Effective Dose',
                    content: 'The final answer: the total effective dose that will be received over 50 years from the internal contamination, accounting for radiation type and tissue sensitivity.'
                },
                'standard': {
                    title: 'Regulatory Standards',
                    content: 'Comparison with dose limits and regulatory requirements. Results inform decisions about medical intervention, work restrictions, and program effectiveness.'
                }
            };
            
            const popup = popups[type];
            alert(`${popup.title}\n\n${popup.content}`);
        }

        // Glossary term hover - Remove old placeholder system, now handled by glossary-modal.js
        /* Removed old alert-based glossary system - replaced with proper modal system */

        // Mark section complete function for button compatibility
        function markSection(sectionId) {
            markSectionComplete(sectionId);
        }
    </script>
</body>
</html>
